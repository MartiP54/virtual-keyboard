const ButtonsRus = {
  Backquote: 'ё', Digit1: '1', Digit2: '2', Digit3: '3', Digit4: '4', Digit5: '5', Digit6: '6', Digit7: '7', Digit8: '8', Digit9: '9', Digit0: '0', Minus: '-', Equal: '=', Backspace: 'BACKSPACE', Tab: 'TAB', KeyQ: 'й', KeyW: 'ц', KeyE: 'у', KeyR: 'к', KeyT: 'е', KeyY: 'н', KeyU: 'г', KeyI: 'ш', KeyO: 'щ', KeyP: 'з', BracketLeft: 'х', BracketRight: 'ъ', Backslash: '\\', Delete: 'DEL', CapsLock: 'CAPSLOCK', KeyA: 'ф', KeyS: 'ы', KeyD: 'в', KeyF: 'а', KeyG: 'п', KeyH: 'р', KeyJ: 'о', KeyK: 'л', KeyL: 'д', Semicolon: 'ж', Quote: 'э', Enter: 'ENTER', ShiftLeft: 'SHIFT', KeyZ: 'я', KeyX: 'ч', KeyC: 'с', KeyV: 'м', KeyB: 'и', KeyN: 'т', KeyM: 'ь', Comma: 'б', Period: 'ю', Slash: '.', ArrowUp: '▲', ShiftRight: 'SHIFT', ControlLeft: 'CTRL', MetaLeft: 'WIN', AltLeft: 'ALT', Space: ' ', AltRight: 'ALT', ControlRight: 'CTRL', ArrowLeft: '◄', ArrowDown: '▼', ArrowRight: '►',
};
const ButtonsEng = {
  Backquote: '`', Digit1: '1', Digit2: '2', Digit3: '3', Digit4: '4', Digit5: '5', Digit6: '6', Digit7: '7', Digit8: '8', Digit9: '9', Digit0: '0', Minus: '-', Equal: '=', Backspace: 'BACKSPACE', Tab: 'TAB', KeyQ: 'q', KeyW: 'w', KeyE: 'e', KeyR: 'r', KeyT: 't', KeyY: 'y', KeyU: 'u', KeyI: 'i', KeyO: 'o', KeyP: 'p', BracketLeft: '[', BracketRight: ']', Backslash: '\\', Delete: 'DEL', CapsLock: 'CAPSLOCK', KeyA: 'a', KeyS: 's', KeyD: 'd', KeyF: 'f', KeyG: 'g', KeyH: 'h', KeyJ: 'j', KeyK: 'k', KeyL: 'l', Semicolon: ';', Quote: "'", Enter: 'ENTER', ShiftLeft: 'SHIFT', KeyZ: 'z', KeyX: 'x', KeyC: 'c', KeyV: 'v', KeyB: 'b', KeyN: 'n', KeyM: 'm', Comma: ',', Period: '.', Slash: '/', ArrowUp: '▲', ShiftRight: 'SHIFT', ControlLeft: 'CTRL', MetaLeft: 'WIN', AltLeft: 'ALT', Space: ' ', AltRight: 'ALT', ControlRight: 'CTRL', ArrowLeft: '◄', ArrowDown: '▼', ArrowRight: '►',
};
const ButtonsShiftRus = {
  Backquote: 'Ё', Digit1: '!', Digit2: '"', Digit3: '№', Digit4: ';', Digit5: '%', Digit6: ':', Digit7: '?', Digit8: '*', Digit9: '(', Digit0: ')', Minus: '_', Equal: '+', Backspace: 'BACKSPACE', Tab: 'TAB', KeyQ: 'Й', KeyW: 'Ц', KeyE: 'У', KeyR: 'К', KeyT: 'Е', KeyY: 'Н', KeyU: 'Г', KeyI: 'Ш', KeyO: 'Щ', KeyP: 'З', BracketLeft: 'Х', BracketRight: 'Ъ', Backslash: '/', Delete: 'DEL', CapsLock: 'CAPSLOCK', KeyA: 'Ф', KeyS: 'Ы', KeyD: 'В', KeyF: 'А', KeyG: 'П', KeyH: 'Р', KeyJ: 'О', KeyK: 'Л', KeyL: 'Д', Semicolon: 'Ж', Quote: 'Э', Enter: 'ENTER', ShiftLeft: 'SHIFT', KeyZ: 'Я', KeyX: 'Ч', KeyC: 'С', KeyV: 'М', KeyB: 'И', KeyN: 'Т', KeyM: 'Ь', Comma: 'Б', Period: 'Ю', Slash: ',', ArrowUp: '▲', ShiftRight: 'SHIFT', ControlLeft: 'CTRL', MetaLeft: 'WIN', AltLeft: 'ALT', Space: ' ', AltRight: 'ALT', ControlRight: 'CTRL', ArrowLeft: '◄', ArrowDown: '▼', ArrowRight: '►',
};
const ButtonsShiftCapsRus = {
  Backquote: 'Ё', Digit1: '!', Digit2: '"', Digit3: '№', Digit4: ';', Digit5: '%', Digit6: ':', Digit7: '?', Digit8: '*', Digit9: '(', Digit0: ')', Minus: '_', Equal: '+', Backspace: 'BACKSPACE', Tab: 'TAB', KeyQ: 'й', KeyW: 'ц', KeyE: 'у', KeyR: 'к', KeyT: 'е', KeyY: 'н', KeyU: 'г', KeyI: 'ш', KeyO: 'щ', KeyP: 'з', BracketLeft: 'х', BracketRight: 'ъ', Backslash: '/', Delete: 'DEL', CapsLock: 'CAPSLOCK', KeyA: 'ф', KeyS: 'ы', KeyD: 'в', KeyF: 'а', KeyG: 'п', KeyH: 'р', KeyJ: 'о', KeyK: 'л', KeyL: 'д', Semicolon: 'ж', Quote: 'э', Enter: 'ENTER', ShiftLeft: 'SHIFT', KeyZ: 'я', KeyX: 'ч', KeyC: 'с', KeyV: 'м', KeyB: 'и', KeyN: 'т', KeyM: 'ь', Comma: 'б', Period: 'ю', Slash: ',', ArrowUp: '▲', ShiftRight: 'SHIFT', ControlLeft: 'CTRL', MetaLeft: 'WIN', AltLeft: 'ALT', Space: ' ', AltRight: 'ALT', ControlRight: 'CTRL', ArrowLeft: '◄', ArrowDown: '▼', ArrowRight: '►',
};
const ButtonsShiftEng = {
  Backquote: '~', Digit1: '!', Digit2: '@', Digit3: '#', Digit4: '$', Digit5: '%', Digit6: '^', Digit7: '&', Digit8: '*', Digit9: '(', Digit0: ')', Minus: '_', Equal: '+', Backspace: 'BACKSPACE', Tab: 'TAB', KeyQ: 'Q', KeyW: 'W', KeyE: 'E', KeyR: 'R', KeyT: 'T', KeyY: 'Y', KeyU: 'U', KeyI: 'I', KeyO: 'O', KeyP: 'P', BracketLeft: '{', BracketRight: '}', Backslash: '|', Delete: 'DEL', CapsLock: 'CAPSLOCK', KeyA: 'A', KeyS: 'S', KeyD: 'D', KeyF: 'F', KeyG: 'G', KeyH: 'H', KeyJ: 'J', KeyK: 'K', KeyL: 'L', Semicolon: ':', Quote: '"', Enter: 'ENTER', ShiftLeft: 'SHIFT', KeyZ: 'Z', KeyX: 'X', KeyC: 'C', KeyV: 'V', KeyB: 'B', KeyN: 'N', KeyM: 'M', Comma: '<', Period: '>', Slash: '?', ArrowUp: '▲', ShiftRight: 'SHIFT', ControlLeft: 'CTRL', MetaLeft: 'WIN', AltLeft: 'ALT', Space: ' ', AltRight: 'ALT', ControlRight: 'CTRL', ArrowLeft: '◄', ArrowDown: '▼', ArrowRight: '►',
};

const ButtonsShiftCapsEng = {
  Backquote: '~', Digit1: '!', Digit2: '@', Digit3: '#', Digit4: '$', Digit5: '%', Digit6: '^', Digit7: '&', Digit8: '*', Digit9: '(', Digit0: ')', Minus: '_', Equal: '+', Backspace: 'BACKSPACE', Tab: 'TAB', KeyQ: 'q', KeyW: 'w', KeyE: 'e', KeyR: 'r', KeyT: 't', KeyY: 'y', KeyU: 'u', KeyI: 'i', KeyO: 'o', KeyP: 'p', BracketLeft: '[', BracketRight: ']', Backslash: '|', Delete: 'DEL', CapsLock: 'CAPSLOCK', KeyA: 'a', KeyS: 's', KeyD: 'd', KeyF: 'f', KeyG: 'g', KeyH: 'h', KeyJ: 'j', KeyK: 'k', KeyL: 'l', Semicolon: ':', Quote: '"', Enter: 'ENTER', ShiftLeft: 'SHIFT', KeyZ: 'z', KeyX: 'x', KeyC: 'c', KeyV: 'v', KeyB: 'b', KeyN: 'n', KeyM: 'm', Comma: '<', Period: '>', Slash: '?', ArrowUp: '▲', ShiftRight: 'SHIFT', ControlLeft: 'CTRL', MetaLeft: 'WIN', AltLeft: 'ALT', Space: ' ', AltRight: 'ALT', ControlRight: 'CTRL', ArrowLeft: '◄', ArrowDown: '▼', ArrowRight: '►',
};
const langStorage = window.sessionStorage;
let lang = langStorage.getItem('language');
if (langStorage.getItem('language') == null) {
  lang = 'rus';
}
let caps = false;
let textareaPosition;

const body = document.querySelector('body');
body.insertAdjacentHTML('afterbegin', '<main class="main"><div class="wrapper"><h1 class="h1">Virtual Keyboard</h1><textarea class="textarea"></textarea><div class="annatation"><h2>Клавиатура создана в операционной системе Windows</h2> <h2>Для переключения языка используйте комбинацию: ctrl + alt</h2></div><div class="keyboard"></h2></div></div></main>');

const textarea = document.querySelector('textarea');
const keyboard = document.querySelector('.keyboard');

function initKeyBoard(key) {
  const div = document.createElement('div');
  const SpanRus = document.createElement('span');
  const SpanRusDefault = document.createElement('span');
  const SpanRusShift = document.createElement('span');
  const SpanRusCaps = document.createElement('span');
  const SpanRusShiftCaps = document.createElement('span');
  const SpanEng = document.createElement('span');
  const SpanEngDefault = document.createElement('span');
  const SpanEngShift = document.createElement('span');
  const SpanEngCaps = document.createElement('span');
  const SpanEngShiftCaps = document.createElement('span');
  keyboard.append(div);
  div.classList.add(key);
  div.append(SpanRus);
  SpanRus.classList.add('rus');
  SpanRus.classList.add('hide');
  div.append(SpanEng);
  SpanEng.classList.add('eng');
  SpanEng.classList.add('hide');

  SpanRus.append(SpanRusDefault);
  SpanRusDefault.classList.add('def');
  SpanRusDefault.innerHTML = ButtonsRus[key];

  SpanRus.append(SpanRusShift);
  SpanRusShift.classList.add('shift');
  SpanRusShift.classList.add('hide');
  SpanRusShift.innerHTML = ButtonsShiftRus[key];

  SpanRus.append(SpanRusCaps);
  SpanRusCaps.classList.add('caps');
  SpanRusCaps.classList.add('hide');
  SpanRusCaps.innerHTML = ButtonsRus[key].toUpperCase();

  SpanRus.append(SpanRusShiftCaps);
  SpanRusShiftCaps.classList.add('shiftCaps');
  SpanRusShiftCaps.classList.add('hide');
  SpanRusShiftCaps.innerHTML = ButtonsShiftCapsRus[key];

  SpanEng.append(SpanEngDefault);
  SpanEngDefault.classList.add('def');
  SpanEngDefault.innerHTML = ButtonsEng[key];

  SpanEng.append(SpanEngShift);
  SpanEngShift.classList.add('shift');
  SpanEngShift.classList.add('hide');
  SpanEngShift.innerHTML = ButtonsShiftEng[key];

  SpanEng.append(SpanEngCaps);
  SpanEngCaps.classList.add('caps');
  SpanEngCaps.classList.add('hide');
  SpanEngCaps.innerHTML = ButtonsEng[key].toUpperCase();

  SpanEng.append(SpanEngShiftCaps);
  SpanEngShiftCaps.classList.add('shiftCaps');
  SpanEngShiftCaps.classList.add('hide');
  SpanEngShiftCaps.innerHTML = ButtonsShiftCapsEng[key];

  div.classList.add('keyboard__key');
  if (key === 'Backspace' || key === 'CapsLock' || key === 'Enter') {
    div.classList.add('keyboard__key_2din');
    div.classList.add('spec');
  }
  if (key === 'ShiftLeft') {
    div.classList.add('keyboard__key_2_5din');
    div.classList.add('spec');
  }
  if (key === 'ShiftRight' || key === 'ControlLeft' || key === 'MetaLeft' || key === 'ControlRight') {
    div.classList.add('keyboard__key_1_5din');
    div.classList.add('spec');
  }
  if (key === 'Space') {
    div.classList.add('keyboard__key_space');
    div.classList.add('spec');
  }
  if (key === 'Tab' || key === 'Delete' || key === 'AltLeft' || key === 'AltRight') {
    div.classList.add('spec');
  }
  if (lang === 'eng') {
    SpanEng.classList.remove('hide');
  } else {
    SpanRus.classList.remove('hide');
  }
}

Object.keys(ButtonsRus).forEach((key) => {
  initKeyBoard(key);
});

const buttons = document.querySelectorAll('.keyboard__key');
const SpanRus = document.querySelectorAll('.rus');
const SpanEng = document.querySelectorAll('.eng');

function languageСhange() {
  document.addEventListener('keydown', (event) => {
    if (event.ctrlKey && event.altKey) {
      if (lang === 'rus') {
        lang = 'eng';
        SpanRus.forEach((e) => {
          e.classList.add('hide');
        });
        SpanEng.forEach((e) => {
          e.classList.remove('hide');
        });
      } else {
        lang = 'rus';
        SpanEng.forEach((e) => {
          e.classList.add('hide');
        });
        SpanRus.forEach((e) => {
          e.classList.remove('hide');
        });
      }
    }
    langStorage.setItem('language', lang);
  });
}

const SpanRusDefault = document.querySelectorAll('.rus .def');
const SpanRusShift = document.querySelectorAll('.rus .shift');
const SpanRusCaps = document.querySelectorAll('.rus .caps');
const SpanRusShiftCaps = document.querySelectorAll('.rus .shiftCaps');

const SpanEngDefault = document.querySelectorAll('.eng .def');
const SpanEngShift = document.querySelectorAll('.eng .shift');
const SpanEngCaps = document.querySelectorAll('.eng .caps');
const SpanEngShiftCaps = document.querySelectorAll('.eng .shiftCaps');

function capsСhange() {
  if (caps === false) {
    caps = true;
    SpanRusDefault.forEach((ev) => {
      ev.classList.add('hide');
    });
    SpanRusCaps.forEach((ev) => {
      ev.classList.remove('hide');
    });
    SpanEngDefault.forEach((ev) => {
      ev.classList.add('hide');
    });
    SpanEngCaps.forEach((ev) => {
      ev.classList.remove('hide');
    });
  } else {
    caps = false;
    SpanRusDefault.forEach((ev) => {
      ev.classList.remove('hide');
    });
    SpanRusCaps.forEach((ev) => {
      ev.classList.add('hide');
    });
    SpanEngDefault.forEach((ev) => {
      ev.classList.remove('hide');
    });
    SpanEngCaps.forEach((ev) => {
      ev.classList.add('hide');
    });
  }
}

function backspaceFunc() {
  if (!(textareaPosition <= 0)) {
    let txtemp = textarea.value;
    txtemp = txtemp.slice(0, textareaPosition - 1) + txtemp.slice(textareaPosition, txtemp.length);
    textarea.value = txtemp;
    textareaPosition -= 1;
    textarea.selectionStart = textareaPosition;
    textarea.selectionEnd = textareaPosition;
  }
}

function deleteFunc() {
  if (!(textareaPosition === textarea.value.length)) {
    let txtemp = textarea.value;
    txtemp = txtemp.slice(0, textareaPosition) + txtemp.slice(textareaPosition + 1, txtemp.length);
    textarea.value = txtemp;
    textarea.selectionStart = textareaPosition;
    textarea.selectionEnd = textareaPosition;
  }
}

function enterFunc() {
  let txtemp = textarea.value;
  txtemp = `${txtemp.slice(0, textareaPosition)}\n${txtemp.slice(textareaPosition, txtemp.length - 1)}`;
  textarea.value = txtemp;
  textarea.value += '\n';
  textarea.selectionStart = textareaPosition + 1;
  textarea.selectionEnd = textareaPosition + 1;
}

function shiftFunc() {
  document.addEventListener('keydown', (event) => {
    if (event.code === 'ShiftLeft') {
      if (caps === true) {
        SpanRusCaps.forEach((ev) => {
          ev.classList.add('hide');
        });
        SpanRusShiftCaps.forEach((ev) => {
          ev.classList.remove('hide');
        });
        SpanEngCaps.forEach((ev) => {
          ev.classList.add('hide');
        });
        SpanEngShiftCaps.forEach((ev) => {
          ev.classList.remove('hide');
        });
      } else {
        SpanRusDefault.forEach((ev) => {
          ev.classList.add('hide');
        });
        SpanRusShift.forEach((ev) => {
          ev.classList.remove('hide');
        });
        SpanEngDefault.forEach((ev) => {
          ev.classList.add('hide');
        });
        SpanEngShift.forEach((ev) => {
          ev.classList.remove('hide');
        });
      }
    }
  });

  document.addEventListener('keyup', (event) => {
    if (event.code === 'ShiftLeft') {
      if (caps === true) {
        SpanRusCaps.forEach((ev) => {
          ev.classList.remove('hide');
        });
        SpanRusShiftCaps.forEach((ev) => {
          ev.classList.add('hide');
        });
        SpanEngCaps.forEach((ev) => {
          ev.classList.remove('hide');
        });
        SpanEngShiftCaps.forEach((ev) => {
          ev.classList.add('hide');
        });
      } else {
        SpanRusDefault.forEach((ev) => {
          ev.classList.remove('hide');
        });
        SpanRusShift.forEach((ev) => {
          ev.classList.add('hide');
        });
        SpanEngDefault.forEach((ev) => {
          ev.classList.remove('hide');
        });
        SpanEngShift.forEach((ev) => {
          ev.classList.add('hide');
        });
      }
    }
  });
}

function shiftFuncMouse() {
  buttons.forEach((b) => b.addEventListener('mousedown', (e) => {
    if (e.currentTarget.classList.contains('ShiftLeft')) {
      if (caps === true) {
        SpanRusCaps.forEach((ev) => {
          ev.classList.add('hide');
        });
        SpanRusShiftCaps.forEach((ev) => {
          ev.classList.remove('hide');
        });
        SpanEngCaps.forEach((ev) => {
          ev.classList.add('hide');
        });
        SpanEngShiftCaps.forEach((ev) => {
          ev.classList.remove('hide');
        });
      } else {
        SpanRusDefault.forEach((ev) => {
          ev.classList.add('hide');
        });
        SpanRusShift.forEach((ev) => {
          ev.classList.remove('hide');
        });
        SpanEngDefault.forEach((ev) => {
          ev.classList.add('hide');
        });
        SpanEngShift.forEach((ev) => {
          ev.classList.remove('hide');
        });
      }
    }
  }));

  buttons.forEach((b) => b.addEventListener('mouseup', (e) => {
    if (e.currentTarget.classList.contains('ShiftLeft')) {
      if (caps === true) {
        SpanRusCaps.forEach((ev) => {
          ev.classList.remove('hide');
        });
        SpanRusShiftCaps.forEach((ev) => {
          ev.classList.add('hide');
        });
        SpanEngCaps.forEach((ev) => {
          ev.classList.remove('hide');
        });
        SpanEngShiftCaps.forEach((ev) => {
          ev.classList.add('hide');
        });
      } else {
        SpanRusDefault.forEach((ev) => {
          ev.classList.remove('hide');
        });
        SpanRusShift.forEach((ev) => {
          ev.classList.add('hide');
        });
        SpanEngDefault.forEach((ev) => {
          ev.classList.remove('hide');
        });
        SpanEngShift.forEach((ev) => {
          ev.classList.add('hide');
        });
      }
    }
  }));
}
shiftFunc();
shiftFuncMouse();
languageСhange();

document.addEventListener('keydown', (event) => {
  event.preventDefault();
  textareaPosition = textarea.selectionStart;
  if (lang === 'rus') {
    Object.keys(ButtonsRus).forEach((key) => {
      if (event.code === key) {
        if (event.code === 'Backspace') {
          textarea.focus();
          backspaceFunc();
        }
        if (event.code === 'Delete') {
          textarea.focus();
          deleteFunc();
        }
        if (event.code === 'Enter') {
          textarea.focus();
          enterFunc();
        }
        if (event.code === 'CapsLock') {
          capsСhange();
        }
        if (!(event.shiftKey || event.altKey || event.ctrlKey || event.metaKey || event.code === 'CapsLock' || event.code === 'Backspace' || event.code === 'Enter' || event.code === 'Tab' || event.code === 'Delete')) {
          textarea.value += ButtonsRus[`${key}`];
        }
      }
    });
  }
  if (lang === 'eng') {
    Object.keys(ButtonsEng).forEach((key) => {
      if (event.code === key) {
        if (event.code === 'Backspace') {
          textarea.focus();
          backspaceFunc();
        }
        if (event.code === 'Delete') {
          textarea.focus();
          deleteFunc();
        }
        if (event.code === 'Enter') {
          textarea.focus();
          enterFunc();
        }
        if (event.code === 'CapsLock') {
          capsСhange();
        }
        if (!(event.shiftKey || event.altKey || event.ctrlKey || event.metaKey || event.code === 'CapsLock' || event.code === 'Backspace' || event.code === 'Enter' || event.code === 'Tab' || event.code === 'Delete')) {
          textarea.value += ButtonsEng[`${key}`];
        }
      }
    });
  }
});

document.addEventListener('click', () => {
  textareaPosition = textarea.selectionStart;
});

buttons.forEach((b) => b.addEventListener('mouseup', (event) => {
  event.currentTarget.childNodes.forEach((e) => {
    if (!(e.classList.contains('hide'))) {
      e.childNodes.forEach((a) => {
        if (!(a.classList.contains('hide')) && (!(a.classList.contains('rus')) && (!(a.classList.contains('eng'))))) {
          if (!(a.textContent === 'SHIFT' || a.textContent === 'ALT' || a.textContent === 'CTRL' || a.textContent === 'TAB' || a.textContent === 'CAPSLOCK' || a.textContent === 'BACKSPACE' || a.textContent === 'WIN' || a.textContent === 'ENTER' || a.textContent === 'DEL')) {
            textarea.value += a.textContent;
            textareaPosition = textarea.selectionStart;
          }
          if (a.textContent === 'ENTER') {
            textarea.focus();
            enterFunc();
          }
          if (a.textContent === 'BACKSPACE') {
            textarea.focus();
            backspaceFunc();
          }
          if (a.textContent === 'DEL') {
            textarea.focus();
            deleteFunc();
          }
        }
      });
    }
  });
  if (event.currentTarget.classList.contains('CapsLock')) {
    capsСhange();
  }
}));

document.addEventListener('keydown', (event) => {
  document.querySelector(`.${event.code}`).classList.add('active');
});

document.addEventListener('keyup', (event) => {
  document.querySelector(`.${event.code}`).classList.remove('active');
});

buttons.forEach((b) => b.addEventListener('mousedown', (e) => {
  e.currentTarget.classList.remove('hover');
  e.currentTarget.classList.add('active');
}));

buttons.forEach((b) => b.addEventListener('mouseup', (e) => {
  e.currentTarget.classList.remove('active');
}));
